<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create or renew a cache for this session — set_cache • epidatr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Open_Sans-0.4.9/font.css" rel="stylesheet"><link href="../deps/Source_Serif_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create or renew a cache for this session — set_cache"><meta name="description" content="By default, epidatr re-requests data from the API on every call of fetch.
In case you find yourself repeatedly calling the same data, you can enable
the cache using either this function for a given session, or environmental
variables for a persistent cache.
The typical recommended workflow for using the cache is to set the
environmental variables EPIDATR_USE_CACHE=TRUE and
EPIDATR_CACHE_DIRECTORY=&quot;/your/directory/here&quot;in your .Renviron, for
example by calling usethis::edit_r_environ().
See the parameters below for some more configurables if you're so inclined.
set_cache (re)defines the cache to use in a particular R session. This does
not clear existing data at any previous location, but instead creates a
handle to the new cache using cachem
that seamlessly handles caching for you.
Say your cache is normally stored in some default directory, but for the
current session you want to save your results in
~/my/temporary/savedirectory, then you would call set_cache(dir = &quot;~/my/temporary/savedirectory&quot;).
Or if you know the data from 2 days ago is wrong, you could call
set_cache(days = 1) to clear older data whenever the cache is referenced.
In both cases, these changes would only last for a single session (though the
deleted data would be gone permanently!).
An important feature of the caching in this package is that only calls which
specify either issues before a certain date, or as_of before a certain
date will actually cache. For example the call
pub_covidcast(
  source = &quot;jhu-csse&quot;,
  signals = &quot;confirmed_7dav_incidence_prop&quot;,
  geo_type = &quot;state&quot;,
  time_type = &quot;day&quot;,
  geo_values = &quot;ca,fl&quot;,
  time_values = epirange(20200601, 20230801)
)

won't cache, since it is possible for the cache to be invalidated by new
releases with no warning. On the other hand, the call
pub_covidcast(
  source = &quot;jhu-csse&quot;,
  signals = &quot;confirmed_7dav_incidence_prop&quot;,
  geo_type = &quot;state&quot;,
  time_type = &quot;day&quot;,
  geo_values = &quot;ca,fl&quot;,
  time_values = epirange(20200601, 20230801),
  as_of = &quot;2023-08-01&quot;
)

will cache, since normal new versions of data can't invalidate it (since
they would be as_of a later date). It is still possible that Delphi may
patch such data, but the frequency is on the order of months rather than
days. We are working on creating a public channel to communicate such
updates. While specifying issues will usually cache, a call with
issues=&quot;*&quot; won't cache, since its subject to cache invalidation by normal
versioning.
On the backend, the cache uses cachem, with filenames generated using an md5
encoding of the call url. Each file corresponds to a unique epidata-API
call."><meta property="og:description" content="By default, epidatr re-requests data from the API on every call of fetch.
In case you find yourself repeatedly calling the same data, you can enable
the cache using either this function for a given session, or environmental
variables for a persistent cache.
The typical recommended workflow for using the cache is to set the
environmental variables EPIDATR_USE_CACHE=TRUE and
EPIDATR_CACHE_DIRECTORY=&quot;/your/directory/here&quot;in your .Renviron, for
example by calling usethis::edit_r_environ().
See the parameters below for some more configurables if you're so inclined.
set_cache (re)defines the cache to use in a particular R session. This does
not clear existing data at any previous location, but instead creates a
handle to the new cache using cachem
that seamlessly handles caching for you.
Say your cache is normally stored in some default directory, but for the
current session you want to save your results in
~/my/temporary/savedirectory, then you would call set_cache(dir = &quot;~/my/temporary/savedirectory&quot;).
Or if you know the data from 2 days ago is wrong, you could call
set_cache(days = 1) to clear older data whenever the cache is referenced.
In both cases, these changes would only last for a single session (though the
deleted data would be gone permanently!).
An important feature of the caching in this package is that only calls which
specify either issues before a certain date, or as_of before a certain
date will actually cache. For example the call
pub_covidcast(
  source = &quot;jhu-csse&quot;,
  signals = &quot;confirmed_7dav_incidence_prop&quot;,
  geo_type = &quot;state&quot;,
  time_type = &quot;day&quot;,
  geo_values = &quot;ca,fl&quot;,
  time_values = epirange(20200601, 20230801)
)

won't cache, since it is possible for the cache to be invalidated by new
releases with no warning. On the other hand, the call
pub_covidcast(
  source = &quot;jhu-csse&quot;,
  signals = &quot;confirmed_7dav_incidence_prop&quot;,
  geo_type = &quot;state&quot;,
  time_type = &quot;day&quot;,
  geo_values = &quot;ca,fl&quot;,
  time_values = epirange(20200601, 20230801),
  as_of = &quot;2023-08-01&quot;
)

will cache, since normal new versions of data can't invalidate it (since
they would be as_of a later date). It is still possible that Delphi may
patch such data, but the frequency is on the order of months rather than
days. We are working on creating a public channel to communicate such
updates. While specifying issues will usually cache, a call with
issues=&quot;*&quot; won't cache, since its subject to cache invalidation by normal
versioning.
On the backend, the cache uses cachem, with filenames generated using an md5
encoding of the call url. Each file corresponds to a unique epidata-API
call."><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">epidatr</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/epidatr.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/signal-discovery.html">Finding data sources and signals of interest</a></li>
    <li><a class="dropdown-item" href="../articles/versioned-data.html">Understanding and accessing versioned data</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cmu-delphi/epidatr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Create or renew a cache for this session</h1>
      <small class="dont-index">Source: <a href="https://github.com/cmu-delphi/epidatr/blob/dev/R/cache.R" class="external-link"><code>R/cache.R</code></a></small>
      <div class="d-none name"><code>set_cache.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>By default, epidatr re-requests data from the API on every call of <code>fetch</code>.
In case you find yourself repeatedly calling the same data, you can enable
the cache using either this function for a given session, or environmental
variables for a persistent cache.
The typical recommended workflow for using the cache is to set the
environmental variables <code>EPIDATR_USE_CACHE=TRUE</code> and
<code>EPIDATR_CACHE_DIRECTORY="/your/directory/here"</code>in your <code>.Renviron</code>, for
example by calling <code><a href="https://usethis.r-lib.org/reference/edit.html" class="external-link">usethis::edit_r_environ()</a></code>.
See the parameters below for some more configurables if you're so inclined.</p>
<p><code>set_cache</code> (re)defines the cache to use in a particular R session. This does
not clear existing data at any previous location, but instead creates a
handle to the new cache using <a href="https://cachem.r-lib.org/index.html" class="external-link">cachem</a>
that seamlessly handles caching for you.
Say your cache is normally stored in some default directory, but for the
current session you want to save your results in
<code>~/my/temporary/savedirectory</code>, then you would call <code>set_cache(dir = "~/my/temporary/savedirectory")</code>.
Or if you know the data from 2 days ago is wrong, you could call
<code>set_cache(days = 1)</code> to clear older data whenever the cache is referenced.
In both cases, these changes would only last for a single session (though the
deleted data would be gone permanently!).</p>
<p>An important feature of the caching in this package is that only calls which
specify either <code>issues</code> before a certain date, or <code>as_of</code> before a certain
date will actually cache. For example the call</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">pub_covidcast</span>(</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  <span class="at">source =</span> <span class="st">"jhu-csse"</span>,</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="at">signals =</span> <span class="st">"confirmed_7dav_incidence_prop"</span>,</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  <span class="at">geo_type =</span> <span class="st">"state"</span>,</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>  <span class="at">time_type =</span> <span class="st">"day"</span>,</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>  <span class="at">geo_values =</span> <span class="st">"ca,fl"</span>,</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>  <span class="at">time_values =</span> <span class="fu">epirange</span>(<span class="dv">20200601</span>, <span class="dv">20230801</span>)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>)</span></code></pre><p></p></div>
<p><em>won't</em> cache, since it is possible for the cache to be invalidated by new
releases with no warning. On the other hand, the call</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">pub_covidcast</span>(</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  <span class="at">source =</span> <span class="st">"jhu-csse"</span>,</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="at">signals =</span> <span class="st">"confirmed_7dav_incidence_prop"</span>,</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  <span class="at">geo_type =</span> <span class="st">"state"</span>,</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>  <span class="at">time_type =</span> <span class="st">"day"</span>,</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>  <span class="at">geo_values =</span> <span class="st">"ca,fl"</span>,</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>  <span class="at">time_values =</span> <span class="fu">epirange</span>(<span class="dv">20200601</span>, <span class="dv">20230801</span>),</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>  <span class="at">as_of =</span> <span class="st">"2023-08-01"</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>)</span></code></pre><p></p></div>
<p><em>will</em> cache, since normal new versions of data can't invalidate it (since
they would be <code>as_of</code> a later date). It is still possible that Delphi may
patch such data, but the frequency is on the order of months rather than
days. We are working on creating a public channel to communicate such
updates. While specifying <code>issues</code> will usually cache, a call with
<code>issues="*"</code> won't cache, since its subject to cache invalidation by normal
versioning.</p>
<p>On the backend, the cache uses cachem, with filenames generated using an md5
encoding of the call url. Each file corresponds to a unique epidata-API
call.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">set_cache</span><span class="op">(</span></span>
<span>  cache_dir <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  days <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max_size <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  logfile <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  confirm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  startup <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-cache-dir">cache_dir<a class="anchor" aria-label="anchor" href="#arg-cache-dir"></a></dt>
<dd><p>the directory in which the cache is stored. By default, this
is <code>rappdirs::user_cache_dir("R", version = "epidatr")</code>. The path can be
either relative or absolute. The environmental variable is
<code>EPIDATR_CACHE_DIR</code>.</p></dd>


<dt id="arg-days">days<a class="anchor" aria-label="anchor" href="#arg-days"></a></dt>
<dd><p>the maximum length of time in days to keep any particular cached
call. By default this is <code>1</code>. The environmental variable is
<code>EPIDATR_CACHE_MAX_AGE_DAYS</code>.</p></dd>


<dt id="arg-max-size">max_size<a class="anchor" aria-label="anchor" href="#arg-max-size"></a></dt>
<dd><p>the size of the entire cache, in MB, at which to start
pruning entries. By default this is <code>1024</code>, or 1GB. The environmental
variable is <code>EPIDATR_CACHE_MAX_SIZE_MB</code>.</p></dd>


<dt id="arg-logfile">logfile<a class="anchor" aria-label="anchor" href="#arg-logfile"></a></dt>
<dd><p>where cachem's log of transactions is stored, relative to the
cache directory. By default, it is <code>"logfile.txt"</code>. The environmental
variable is <code>EPIDATR_CACHE_LOGFILE</code>.</p></dd>


<dt id="arg-confirm">confirm<a class="anchor" aria-label="anchor" href="#arg-confirm"></a></dt>
<dd><p>whether to confirm directory creation. default is <code>TRUE</code>;
should only be set in non-interactive scripts</p></dd>


<dt id="arg-startup">startup<a class="anchor" aria-label="anchor" href="#arg-startup"></a></dt>
<dd><p>indicates whether the function is being called on
startup. Affects suppressability of the messages. Default is <code>FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code><a href="https://rdrr.io/r/base/NULL.html" class="external-link">NULL</a></code> no return value, all effects are stored in the package
environment</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="clear_cache.html">clear_cache</a></code> to delete the old cache while making a new one,
<code><a href="disable_cache.html">disable_cache</a></code> to disable without deleting, and <code><a href="cache_info.html">cache_info</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu">set_cache</span><span class="op">(</span></span></span>
<span class="r-in"><span>  cache_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  days <span class="op">=</span> <span class="fl">14</span>,</span></span>
<span class="r-in"><span>  max_size <span class="op">=</span> <span class="fl">512</span>,</span></span>
<span class="r-in"><span>  logfile <span class="op">=</span> <span class="st">"logs.txt"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #BBBB00;">!</span> epidatr cache is being used (set env var EPIDATR_USE_CACHE=FALSE if not</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   intended).</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> The cache directory is /tmp/RtmpFZauc0.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> The cache will be cleared after 14 days and will be pruned if it exceeds 512</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   MB.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> The log of cache transactions is stored at /tmp/RtmpFZauc0/logs.txt.</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p><a href="https://delphi.cmu.edu/about/" class="external-link">About Delphi</a> • <a href="https://delphi.cmu.edu/epidemic-signals/terms-of-use/" class="external-link">Terms of Use</a> • <a href="https://docs.google.com/forms/u/1/d/e/1FAIpQLScqgT1fKZr5VWBfsaSp-DNaN03aV6EoZU4YljIzHJ1Wl_zmtg/viewform" class="external-link">Contact Us</a> • <a href="https://github.com/cmu-delphi/" class="external-link">Delphi GitHub</a> • <a href="https://cmu-delphi.github.io/delphi-epidata/" class="external-link">Epidata API</a></p>
</div>

<div class="pkgdown-footer-right">
  <p>epidatr</p>
</div>

    </footer></div>





  </body></html>

