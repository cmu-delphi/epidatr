---
title: "Endpoint Examples"
author: "Delphi Group"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Endpoint Examples}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries}
# remotes::install_github("cmu-delphi/epidatr")
library("epidatr")
library("magrittr")
library("dplyr")
```

The API endpoints, organized by data sources.
Some endpoints allow for the use of `*` to access data at all locations. Check the help for a given endpoint to see if it supports `*`.

## COVIDcast Main Endpoint

All of these signals use the command `covidcast`, with variation in which source and signal are used.

Data Sources and Signals documentation: <https://cmu-delphi.github.io/delphi-epidata/api/covidcast_signals.html>

Function reference: <https://cmu-delphi.github.io/epidatr/reference/covidcast.html>

To understand the available sources better, use `covidcast_epidata()` and `covidcast_meta()`.

```{r}
covidcast_epidata()
```

For example, let's see what kind of smoothed signals come out of the [facebook survey](https://cmu-delphi.github.io/delphi-epidata/api/covidcast-signals/fb-survey.html) source:

```{r}
cm <- covidcast_meta() %>%
  fetch_tbl() %>%
  dplyr::filter(grepl("smoothed", signal), data_source == "fb-survey")
```

grabbing the first smoothed signal as an example:

```{r}
cm[1, ] %>% print(width = 100)
cm[1, "signal"]
```

and actually fetching some data from this source

```{r}
covidcast(
  data_source = "fb-survey",
  signals = "smoothed_accept_covid_vaccine",
  geo_type = "county",
  time_type = "day",
  time_values = epirange(20201221, 20201225),
  geo_values = "06059"
) %>% fetch_tbl()
```

County geo_values are [FIPS codes](https://en.wikipedia.org/wiki/List_of_United_States_FIPS_codes_by_county) and are discussed more here: <https://cmu-delphi.github.io/delphi-epidata/api/covidcast_geography.html>. The example above is for Orange County, California.
Since `covidcast` is an endpoint which supports `*`, here is an example of its use:

```{r}
covidcast(
  data_source = "fb-survey",
  signals = "smoothed_accept_covid_vaccine",
  geo_type = "county",
  time_type = "day",
  time_values = epirange(20201221, 20201225),
  geo_values = "*"
) %>% fetch_tbl()
```

## Other Covid Endpoints

### COVID-19 Hospitalization: Facility Lookup

API docs: <https://cmu-delphi.github.io/delphi-epidata/api/covid_hosp_facility_lookup.html>

Function reference: <https://cmu-delphi.github.io/epidatr/reference/covid_hosp_facility_lookup.html>

Example calls:

```{r}
covid_hosp_facility_lookup(city = "southlake") %>% fetch_tbl()
```

```{r}
covid_hosp_facility_lookup(state = "WY") %>% fetch_tbl()
```

A non-example (there is no city called New York in Wyoming);

```{r}
covid_hosp_facility_lookup(state = "WY", city = "New York") %>% fetch_tbl()
```

### COVID-19 Hospitalization by Facility

API docs: <https://cmu-delphi.github.io/delphi-epidata/api/covid_hosp_facility.html>

Function reference: <https://cmu-delphi.github.io/epidatr/reference/covid_hosp_facility.html>

Example call:

```{r}
covid_hosp_facility(
  hospital_pks = "100075",
  collection_weeks = epirange(20200101, 20200501)
) %>% fetch_tbl()
```

### COVID-19 Hospitalization by State

API docs: <https://cmu-delphi.github.io/delphi-epidata/api/covid_hosp.html>

Function reference: <https://cmu-delphi.github.io/epidatr/reference/covid_hosp.html>

Example call:

```{r}
covid_hosp_state_timeseries(states = "MA", dates = "20200510") %>% fetch_tbl()
```

## Flu Endpoints

### Delphi's ILINet forecasts

API docs: <https://cmu-delphi.github.io/delphi-epidata/api/delphi.html>

Function reference: <https://cmu-delphi.github.io/epidatr/reference/delphi.html>

Example call:

```{r}
del <- delphi(system = "ec", epiweek = 201501) %>% fetch_classic()
names(del$epidata$forecast)
```

### FluSurv hospitalization data

API docs: <https://cmu-delphi.github.io/delphi-epidata/api/flusurv.html>

Function reference: <https://cmu-delphi.github.io/epidatr/reference/flusurv.html>

Example call:

```{r}
flusurv(locations = "ca", epiweeks = 202001) %>% fetch_tbl()
```

### Fluview data

API docs: <https://cmu-delphi.github.io/delphi-epidata/api/fluview.html>

Function reference: <https://cmu-delphi.github.io/epidatr/reference/fluview.html>

Example call:

```{r}
fluview(regions = "nat", epiweeks = epirange(201201, 202001)) %>% fetch_tbl()
```

### Fluview virological data from clinical labs

API docs: <https://cmu-delphi.github.io/delphi-epidata/api/fluview_clinical.html>

Function reference: <https://cmu-delphi.github.io/epidatr/reference/fluview_clinical.html>

Example call:

```{r}
fluview_clinical(regions = "nat", epiweeks = epirange(201601, 201701)) %>% fetch_tbl()
```

### Fluview metadata

Function reference: <https://cmu-delphi.github.io/epidatr/reference/fluview_metadata.html>

Example call:

```{r}
fluview_meta() %>% fetch_tbl()
```

### Google Flu Trends data

API docs: <https://cmu-delphi.github.io/delphi-epidata/api/gft.html>

Function reference: <https://cmu-delphi.github.io/epidatr/reference/gft.html>

```{r}
gft(locations = "hhs1", epiweeks = epirange(201201, 202001)) %>% fetch_tbl()
```

### ECDC ILI

API docs: <https://cmu-delphi.github.io/delphi-epidata/api/ecdc_ili.html>

Function reference: <https://cmu-delphi.github.io/epidatr/reference/ecdc_ili.html>

```{r}
ecdc_ili(regions = "Armenia", epiweeks = 201840) %>% fetch_tbl()
```

### KCDC ILI

API docs: <https://cmu-delphi.github.io/delphi-epidata/api/kcdc_ili.html>

Function reference: <https://cmu-delphi.github.io/epidatr/reference/kcdc_ili.html>

```{r}
kcdc_ili(regions = "ROK", epiweeks = 200436) %>% fetch_tbl()
```

### NIDSS Flu

API docs: <https://cmu-delphi.github.io/delphi-epidata/api/nidss_flu.html>

Function reference: <https://cmu-delphi.github.io/epidatr/reference/nidss_flu.html>

```{r}
nidss_flu(regions = "taipei", epiweeks = epirange(200901, 201301)) %>% fetch_tbl()
```

### ILI Nearby Nowcast

API docs: <https://cmu-delphi.github.io/delphi-epidata/api/nowcast.html>

Function reference: <https://cmu-delphi.github.io/epidatr/reference/nowcast.html>

```{r}
nowcast(locations = "ca", epiweeks = epirange(202201, 202319)) %>% fetch_tbl()
```

## Dengue Endpoints

### Delphi's Dengue Nowcast

API docs: <https://cmu-delphi.github.io/delphi-epidata/api/dengue_nowcast.html>

Function reference: <https://cmu-delphi.github.io/epidatr/reference/dengue_nowcast.html>

Example call:

```{r}
dengue_nowcast(locations = "pr", epiweeks = epirange(201401, 202301)) %>% fetch_tbl()
```

### NIDSS dengue

API docs: <https://cmu-delphi.github.io/delphi-epidata/api/nidss_dengue.html>

Function reference: <https://cmu-delphi.github.io/epidatr/reference/nidss_dengue.html>

```{r}
nidss_dengue(locations = "taipei", epiweeks = epirange(200301, 201301)) %>% fetch_tbl()
```

## PAHO Dengue

API docs: <https://cmu-delphi.github.io/delphi-epidata/api/paho_dengue.html>

Function reference: <https://cmu-delphi.github.io/epidatr/reference/paho_dengue.html>

```{r, eval=FALSE}
paho_dengue(regions = "ca", epiweeks = epirange(200201, 202319)) %>% fetch_tbl()
```

## Other Endpoints

### Wikipedia Access

API docs: <https://cmu-delphi.github.io/delphi-epidata/api/wiki.html>

Function reference: <https://cmu-delphi.github.io/epidatr/reference/wiki.html>

```{r}
wiki(language = "en", articles = "influenza", epiweeks = epirange(202001, 202319)) %>% fetch_tbl()
```

# Private methods

These require private access keys to use. To actually run these locally, you will need to store these secrets in your `.Reviron` file, or set them as environmental variables.

### CDC

API docs: <https://cmu-delphi.github.io/delphi-epidata/api/cdc.html>

Function reference: <https://cmu-delphi.github.io/epidatr/reference/pvt_cdc.html>

Example call:

```{r, eval=FALSE}
pvt_cdc(auth = Sys.getenv("SECRET_API_AUTH_CDC"), epiweeks = epirange(202003, 202304), locations = "ma") %>% fetch_tbl()
```

### Dengue Digital Surveillance Sensors

API docs: <https://cmu-delphi.github.io/delphi-epidata/api/dengue_sensors.html>

Function reference: <https://cmu-delphi.github.io/epidatr/reference/dengue_sensors.html>

Example call:

```{r, eval=FALSE}
pvt_dengue_sensors(auth = Sys.getenv("SECRET_API_AUTH_SENSORS"), names = "ght", locations = "ag", epiweeks = epirange(201404, 202004)) %>% fetch_tbl()
```

### Google Health Trends

API docs: <https://cmu-delphi.github.io/delphi-epidata/api/ght.html>

Function reference: <https://cmu-delphi.github.io/epidatr/reference/pvt_ght.html>

Example call:

```{r, eval=FALSE}
pvt_ght(auth = Sys.getenv("SECRET_API_AUTH_GHT"), epiweeks = epirange(199301, 202304), locations = "ma", query = "how to get over the flu") %>% fetch_tbl()
```

### NoroSTAT metadata

API docs: <https://cmu-delphi.github.io/delphi-epidata/api/meta_norostat.html>

Function reference: <https://cmu-delphi.github.io/epidatr/reference/pvt_meta_norostat.html>

Example call:

```{r, eval=FALSE}
pvt_meta_norostat(auth = Sys.getenv("SECRET_API_AUTH_NOROSTAT")) %>% fetch_classic()
```

### NoroSTAT data

API docs: <https://cmu-delphi.github.io/delphi-epidata/api/norostat.html>

Function reference: <https://cmu-delphi.github.io/epidatr/reference/pvt_norostat.html>

Example call:

```{r, eval=FALSE}
pvt_norostat(auth = Sys.getenv("SECRET_API_AUTH_NOROSTAT"), locations = "1", epiweeks = 201233) %>% fetch_classic()

```

### Quidel Covid and Influenza testing

API docs: <https://cmu-delphi.github.io/delphi-epidata/api/quidel.html>

Function reference: <https://cmu-delphi.github.io/epidatr/reference/pvt_quidel.html>

Example call:

```{r, eval=FALSE}
pvt_quidel(auth = Sys.getenv("SECRET_API_AUTH_QUIDEL"), locations = "hhs1", epiweeks = epirange(200301, 202105)) %>% fetch_tbl()
```

### Sensors

API docs: <https://cmu-delphi.github.io/delphi-epidata/api/sensors.html>

Function reference: <https://cmu-delphi.github.io/epidatr/reference/pvt_sensors.html>

Example call:

```{r, eval=FALSE}
pvt_sensors(auth = Sys.getenv("SECRET_API_AUTH_SENSORS"), names = "sar3", locations = "nat", epiweeks = epirange(200301, 202105)) %>% fetch_tbl()
```

### Twitter

API docs: <https://cmu-delphi.github.io/delphi-epidata/api/twitter.html>

Function reference: <https://cmu-delphi.github.io/epidatr/reference/pvt_twitter.html>

Example call:

```{r, eval=FALSE}
pvt_twitter(auth = Sys.getenv("SECRET_API_AUTH_TWITTER"), locations = "nat", epiweeks = epirange(200301, 202105)) %>% fetch_tbl()
```
